<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sheckle Market</title>

  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script type="text/javascript">
    // EmailJS Configuration - REPLACE THESE WITH YOUR ACTUAL VALUES
    const EMAILJS_PUBLIC_KEY = 'c3M0Mn0DjoznjXaC8'; // Get from EmailJS dashboard
    const EMAILJS_SERVICE_ID = 'gmail_service'; // Get from EmailJS dashboard  
    const EMAILJS_TEMPLATE_ID = 'verification_template'; // Get from EmailJS dashboard
    
    // Initialize EmailJS
    let emailJSAvailable = false;
    try {
      if (typeof emailjs !== 'undefined' && EMAILJS_PUBLIC_KEY !== 'YOUR_ACTUAL_PUBLIC_KEY') {
        emailjs.init(EMAILJS_PUBLIC_KEY);
        emailJSAvailable = true;
        console.log('EmailJS initialized successfully');
      } else {
        console.log('EmailJS not configured properly - check your credentials');
      }
    } catch (error) {
      console.error('EmailJS initialization failed:', error);
    }
  </script>

  <style>
    :root {
      --bg: #0d1117;
      --fg: #c9d1d9;
      --panel: #161b22;
      --accent: #58a6ff;
      --btn: #238636;
      --btn-h: #2ea043;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--fg);
      scroll-behavior: smooth;
      transition: all 0.3s ease;
    }
    header {
      background: var(--panel);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
      color: var(--accent);
    }
    nav a {
      color: var(--fg);
      margin-left: 1rem;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
    }
    nav a:hover,
    nav a.active {
      color: var(--accent);
    }
    nav a span {
      font-weight: normal;
    }
    .section {
      display: none;
      padding: 3rem 2rem;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .section.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .panel {
      background: var(--panel);
      border-radius: 10px;
      margin: 2rem auto;
      max-width: 500px;
      padding: 2rem;
      text-align: center;
    }
    /* Market */
    .market-item {
      margin-top: 2rem;
      background: var(--bg);
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 1.5rem;
    }
    .market-item h4 {
      margin: 0.5rem 0;
      font-size: 1.4rem;
    }
    .market-item button {
      padding: 0.7rem 1.5rem;
      background: var(--btn);
      color: #fff;
      border: 0;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    .market-item button:hover {
      background: var(--btn-h);
    }
    /* Forms */
    .form-section input {
      width: 100%;
      padding: 0.6rem;
      margin: 0.5rem 0;
      border: 0;
      border-radius: 5px;
      background: var(--bg);
      color: var(--fg);
    }
    .form-section button {
      width: 100%;
      padding: 0.7rem;
      background: var(--btn);
      color: #fff;
      border: 0;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1rem;
    }
    .form-section button:hover {
      background: var(--btn-h);
    }
    .form-section button:disabled {
      background: #666;
      cursor: not-allowed;
    }
    /* Cart */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th,
    td {
      padding: 0.6rem;
      border-bottom: 1px solid #30363d;
      text-align: left;
    }
    td.qty {
      text-align: center;
      width: 60px;
    }
    td.price,
    td.sub {
      text-align: right;
      width: 80px;
    }
    .cart-actions button {
      margin: 0.5rem;
      padding: 0.6rem 1rem;
      cursor: pointer;
      border-radius: 5px;
      border: none;
      font-weight: bold;
    }
    .cart-actions button:first-child {
      background: var(--btn);
      color: #fff;
    }
    .cart-actions button:first-child:hover {
      background: var(--btn-h);
    }
    .cart-actions button:last-child {
      background: #a40d0d;
      color: #fff;
    }
    .cart-actions button:last-child:hover {
      background: #d13131;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: var(--bg);
      color: #8b949e;
      font-size: 0.9rem;
    }
    
    .error-msg {
      color: #ff6b6b;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .success-msg {
      color: #51cf66;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }


  </style>
</head>
<body>
  <header>
    <h1>Sheckle Market</h1>
    <nav>
      <a class="tab-link active" data-target="market">Market</a>
      <a class="tab-link" data-target="login">Login</a>
      <a class="tab-link" data-target="signup">Signup</a>
      <a class="tab-link" data-target="cart">Cart (<span id="cart-count">0</span>)</a>
      <a class="tab-link" data-target="profile" id="profile-tab" style="display: none;">Profile</a>
    </nav>
  </header>

  <!-- Market -->
  <section id="market" class="section active">
    <div class="panel">
      <h3>Market Exchange</h3>
      <p>üí∞ 1 Trillion Sheckles = $2.99</p>

      <div class="market-item">
        <h4>1 Trillion Sheckles</h4>
        <button onclick="addToCart('sheckles1t', '1 Trillion Sheckles', 2.99)">$2.99 ‚Äì BUY</button>
      </div>
    </div>
  </section>

  <!-- Login -->
  <section id="login" class="section">
    <div class="panel form-section">
      <h3>Login</h3>
      <input id="login-user" type="text" placeholder="Username" />
      <input id="login-pass" type="password" placeholder="Password" />
      <button onclick="login()">Login</button>
    </div>
  </section>

  <!-- Signup -->
  <section id="signup" class="section">
    <div class="panel form-section">
      <h3>Sign Up</h3>
      <input id="signup-user" type="text" placeholder="Username" />
      <input id="signup-pass" type="password" placeholder="Password" />
      <input id="signup-email" type="email" placeholder="Gmail" />
      <button id="signup-btn" onclick="signup()">Sign Up</button>
      <div id="signup-status"></div>
    </div>
  </section>

  <!-- Cart -->
  <section id="cart" class="section">
    <div class="panel" id="cart-panel"></div>
  </section>

  <!-- Profile -->
  <section id="profile" class="section">
    <div class="panel">
      <h3>My Profile</h3>
      <div style="margin: 2rem 0;">
        <svg width="80" height="80" viewBox="0 0 100 100" style="margin: 0 auto; display: block;">
          <circle cx="50" cy="50" r="50" fill="#000000"/>
          <circle cx="50" cy="35" r="15" fill="#ffffff"/>
          <path d="M 20 85 Q 20 65 50 65 Q 80 65 80 85 Z" fill="#ffffff"/>
        </svg>
      </div>
      <h4 id="profile-username">Welcome!</h4>
      <p>Account created successfully</p>
      <button onclick="logout()" style="
        padding: 0.7rem 1.5rem;
        background: #6c757d;
        color: #fff;
        border: 0;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 1rem;
      ">Logout</button>
    </div>
  </section>

  <footer>
    &copy; 2025 Sheckle Market. All rights reserved. | 
    <span id="last-updated">Website updated just now</span>
  </footer>

  <script>
    // Tab switching
    document.querySelectorAll('.tab-link').forEach((link) => {
      link.addEventListener('click', () => {
        document.querySelectorAll('.tab-link').forEach((l) =>
          l.classList.remove('active')
        );
        document.querySelectorAll('.section').forEach((s) =>
          s.classList.remove('active')
        );
        link.classList.add('active');
        document.getElementById(link.dataset.target).classList.add('active');
        if (link.dataset.target === 'cart') renderCart();
      });
    });

    // Cart Logic (using variables instead of localStorage)
    let cartData = [];
    
    function getCart() {
      return cartData;
    }
    
    function saveCart(cart) {
      cartData = cart;
      document.getElementById('cart-count').textContent = cart.reduce(
        (n, i) => n + i.qty,
        0
      );
    }
    
    function addToCart(id, name, price) {
      // Check if user is logged in
      if (!currentUser) {
        alert('‚ö†Ô∏è Please create an account and login to make purchases!');
        return;
      }
      
      const cart = getCart();
      const item = cart.find((i) => i.id === id);
      if (item) {
        item.qty++;
      } else {
        cart.push({ id, name, price, qty: 1 });
      }
      saveCart(cart);
      alert('‚úÖ Added to cart!');
    }
    
    function removeItem(id) {
      let cart = getCart().filter((i) => i.id !== id);
      saveCart(cart);
      renderCart();
    }
    
    function clearCart() {
      saveCart([]);
      renderCart();
    }
    
    function renderCart() {
      const cart = getCart();
      const panel = document.getElementById('cart-panel');
      if (cart.length === 0) {
        panel.innerHTML = '<h3>Your cart is empty.</h3>';
        return;
      }
      let rows = cart
        .map(
          (i) => `
        <tr>
          <td>${i.name}</td>
          <td class="qty">${i.qty}</td>
          <td class="price">$${i.price.toFixed(2)}</td>
          <td class="sub">$${(i.qty * i.price).toFixed(2)}</td>
          <td><button onclick="removeItem('${i.id}')">Remove</button></td>
        </tr>`
        )
        .join('');
      const total = cart.reduce((t, i) => t + i.qty * i.price, 0).toFixed(2);
      panel.innerHTML = `
        <h3>Your Cart</h3>
        <table>
          <thead>
            <tr>
              <th>Item</th><th>Qty</th><th class="price">Price</th><th class="sub">Subtotal</th><th></th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <h4>Total: $${total}</h4>
        <div class="cart-actions">
          <button onclick="checkout()">Checkout</button>
          <button onclick="clearCart()">Clear Cart</button>
        </div>`;
    }
    
    function checkout() {
      // Check if user is logged in
      if (!currentUser) {
        alert('‚ö†Ô∏è Please login to complete your purchase!');
        return;
      }
      
      if (confirm('Proceed to checkout?')) {
        alert('üéâ Purchase successful! Thank you.');
        clearCart();
      }
    }

    // User data storage (using variables instead of localStorage)
    let userData = {};
    let pendingSignup = {};
    let currentUser = null;

    // Enhanced signup with real email sending
    async function signup() {
      const user = document.getElementById('signup-user').value.trim();
      const pass = document.getElementById('signup-pass').value;
      const email = document.getElementById('signup-email').value.trim();
      const statusDiv = document.getElementById('signup-status');
      const signupBtn = document.getElementById('signup-btn');

      // Clear previous status
      statusDiv.innerHTML = '';

      if (!user || !pass || !email) {
        statusDiv.innerHTML = '<div class="error-msg">Please fill in all fields.</div>';
        return;
      }

      if (userData['user_' + user]) {
        statusDiv.innerHTML = '<div class="error-msg">‚ùå Username already exists.</div>';
        return;
      }

      // Enhanced Gmail validation
      if (!email.toLowerCase().endsWith('@gmail.com')) {
        statusDiv.innerHTML = '<div class="error-msg">Please enter a valid Gmail address.</div>';
        return;
      }

      const code = Math.floor(100000 + Math.random() * 900000); // 6-digit code

      // Save pending signup data
      pendingSignup = {
        email: email,
        user: user,
        pass: pass,
        code: code.toString()
      };

      statusDiv.innerHTML = '<div class="success-msg">üìß Sending verification code...</div>';
      signupBtn.disabled = true;

      // Check if EmailJS is properly configured
      if (!emailJSAvailable) {
        statusDiv.innerHTML = '<div class="error-msg">‚ùå Email service not configured. Please set up EmailJS credentials.</div>';
        signupBtn.disabled = false;
        return;
      }

      try {
        // Prepare email template parameters
        const templateParams = {
          to_email: email,
          to_name: user,
          verification_code: code,
          subject: 'Sheckle Market - Email Verification',
          message: `Hello ${user},\n\nYour verification code for Sheckle Market is: ${code}\n\nPlease enter this code to complete your registration.\n\nThank you!`
        };

        // Send real email via EmailJS
        const response = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
        
        console.log('Email sent successfully:', response);
        statusDiv.innerHTML = '<div class="success-msg">üìß Verification code sent to your Gmail!</div>';
        
        // Show verification prompt after successful email send
        setTimeout(() => {
          showVerificationPrompt();
        }, 1000);

      } catch (error) {
        console.error('Failed to send email:', error);
        statusDiv.innerHTML = '<div class="error-msg">‚ùå Failed to send verification email. Please check your email address and try again.</div>';
        signupBtn.disabled = false;
        pendingSignup = {}; // Clear pending data on failure
      }
    }

    function showVerificationPrompt() {
      const signupBtn = document.getElementById('signup-btn');
      signupBtn.disabled = false;

      // Create popup overlay
      const overlay = document.createElement('div');
      overlay.id = 'verification-overlay';
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      `;

      // Create popup
      const popup = document.createElement('div');
      popup.style.cssText = `
        background: var(--panel);
        border-radius: 10px;
        padding: 2rem;
        max-width: 400px;
        width: 90%;
        text-align: center;
        border: 1px solid #30363d;
      `;

      popup.innerHTML = `
        <h3 style="color: var(--accent); margin-top: 0;">üìß Email Verification</h3>
        <p style="margin: 1rem 0;">Check your Gmail and enter the 6-digit verification code:</p>
        <input id="verification-code" type="text" placeholder="000000" maxlength="6" style="
          width: 100%;
          padding: 0.8rem;
          margin: 1rem 0;
          border: 0;
          border-radius: 5px;
          background: var(--bg);
          color: var(--fg);
          text-align: center;
          font-size: 1.2rem;
          letter-spacing: 0.2rem;
        " />
        <div style="display: flex; gap: 1rem; justify-content: center;">
          <button id="verify-btn" style="
            padding: 0.7rem 1.5rem;
            background: var(--btn);
            color: #fff;
            border: 0;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
          ">Verify</button>
          <button id="cancel-btn" style="
            padding: 0.7rem 1.5rem;
            background: #6c757d;
            color: #fff;
            border: 0;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
          ">Cancel</button>
        </div>
        <div id="verification-status" style="margin-top: 1rem;"></div>
        <p style="font-size: 0.8rem; color: #8b949e; margin-top: 1rem;">
          Didn't receive the email? Check your spam folder or try again.
        </p>
      `;

      overlay.appendChild(popup);
      document.body.appendChild(overlay);

      // Focus on input
      const codeInput = document.getElementById('verification-code');
      codeInput.focus();

      // Handle verify button
      document.getElementById('verify-btn').onclick = function() {
        const enteredCode = codeInput.value.trim();
        const statusDiv = document.getElementById('verification-status');
        const signupStatusDiv = document.getElementById('signup-status');
        
        if (enteredCode === pendingSignup.code) {
          // Success - create account
          userData['user_' + pendingSignup.user] = pendingSignup.pass;
          signupStatusDiv.innerHTML = '<div class="success-msg">‚úÖ Account created successfully! You can now login.</div>';
          
          // Clear form
          document.getElementById('signup-user').value = '';
          document.getElementById('signup-pass').value = '';
          document.getElementById('signup-email').value = '';
          
          // Clear pending data
          pendingSignup = {};
          
          // Close popup
          document.body.removeChild(overlay);
        } else {
          statusDiv.innerHTML = '<div class="error-msg">‚ùå Incorrect verification code. Please try again.</div>';
          codeInput.value = '';
          codeInput.focus();
        }
      };

      // Handle cancel button
      document.getElementById('cancel-btn').onclick = function() {
        document.getElementById('signup-status').innerHTML = '<div class="error-msg">Verification cancelled.</div>';
        pendingSignup = {};
        document.body.removeChild(overlay);
      };

      // Handle Enter key
      codeInput.onkeypress = function(e) {
        if (e.key === 'Enter') {
          document.getElementById('verify-btn').click();
        }
      };
    }

    function login() {
      const user = document.getElementById('login-user').value.trim();
      const pass = document.getElementById('login-pass').value;
      if (!user || !pass) {
        alert('Please fill in all fields.');
        return;
      }
      const stored = userData['user_' + user];
      if (stored === pass) {
        currentUser = user;
        document.getElementById('profile-username').textContent = `Welcome, ${user}!`;
        document.getElementById('profile-tab').style.display = 'inline';
        
        // Clear login form
        document.getElementById('login-user').value = '';
        document.getElementById('login-pass').value = '';
        
        // Switch to profile tab
        document.querySelectorAll('.tab-link').forEach((l) => l.classList.remove('active'));
        document.querySelectorAll('.section').forEach((s) => s.classList.remove('active'));
        document.querySelector('[data-target="profile"]').classList.add('active');
        document.getElementById('profile').classList.add('active');
        
        alert(`‚úÖ Welcome back, ${user}!`);
      } else {
        alert('‚ùå Invalid username or password.');
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById('profile-tab').style.display = 'none';
      
      // Switch back to market tab
      document.querySelectorAll('.tab-link').forEach((l) => l.classList.remove('active'));
      document.querySelectorAll('.section').forEach((s) => s.classList.remove('active'));
      document.querySelector('[data-target="market"]').classList.add('active');
      document.getElementById('market').classList.add('active');
      
      alert('üëã Logged out successfully!');
    }

    // Initialize cart
    saveCart(getCart());
  </script>
</body>
</html>
